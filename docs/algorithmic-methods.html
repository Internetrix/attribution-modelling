<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 Algorithmic Methods | The Internetrix Advanced Guide to Attribution Modelling</title>
  <meta name="description" content="This is an Internetrix guide on advanced marketing attribution modelling for eCommerce data" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="9 Algorithmic Methods | The Internetrix Advanced Guide to Attribution Modelling" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="img/attributionmodellingcover.png" />
  <meta property="og:description" content="This is an Internetrix guide on advanced marketing attribution modelling for eCommerce data" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 Algorithmic Methods | The Internetrix Advanced Guide to Attribution Modelling" />
  
  <meta name="twitter:description" content="This is an Internetrix guide on advanced marketing attribution modelling for eCommerce data" />
  <meta name="twitter:image" content="img/attributionmodellingcover.png" />

<meta name="author" content="Dean Marchiori - Head of Data Science, Internetrix" />
<meta name="author" content="Tiffany Chen - Data Analyst, Internetrix" />


<meta name="date" content="2019-06-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="heuristic-models.html">
<link rel="next" href="about-offline-attribution.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html">Home</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#contact-internetrix"><i class="fa fa-check"></i><b>1.1</b> Contact Internetrix</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#what-is-attribution-modelling"><i class="fa fa-check"></i><b>2.1</b> What is attribution modelling</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#definitions"><i class="fa fa-check"></i><b>2.2</b> Definitions</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#scope-of-this-paper"><i class="fa fa-check"></i><b>2.3</b> Scope of this paper</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#where-to-go-for-further-help"><i class="fa fa-check"></i><b>2.4</b> Where to go for further help</a></li>
</ul></li>
<li class="part"><span><b>I Online Attribution</b></span></li>
<li class="chapter" data-level="3" data-path="types-of-attribution.html"><a href="types-of-attribution.html"><i class="fa fa-check"></i><b>3</b> Types of Attribution</a><ul>
<li class="chapter" data-level="3.1" data-path="types-of-attribution.html"><a href="types-of-attribution.html#group-vs.individual-attribution"><i class="fa fa-check"></i><b>3.1</b> Group vs. Individual Attribution</a></li>
<li class="chapter" data-level="3.2" data-path="types-of-attribution.html"><a href="types-of-attribution.html#simplistic-vs.fractional-modelling"><i class="fa fa-check"></i><b>3.2</b> Simplistic vs. Fractional Modelling</a><ul>
<li class="chapter" data-level="3.2.1" data-path="types-of-attribution.html"><a href="types-of-attribution.html#simplistic-modelling"><i class="fa fa-check"></i><b>3.2.1</b> Simplistic modelling</a></li>
<li class="chapter" data-level="3.2.2" data-path="types-of-attribution.html"><a href="types-of-attribution.html#fractional-modelling"><i class="fa fa-check"></i><b>3.2.2</b> Fractional modelling</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="types-of-attribution.html"><a href="types-of-attribution.html#heuristic-vs.algorithmic-modelling"><i class="fa fa-check"></i><b>3.3</b> Heuristic vs. Algorithmic Modelling</a><ul>
<li class="chapter" data-level="3.3.1" data-path="types-of-attribution.html"><a href="types-of-attribution.html#the-heuristic-model"><i class="fa fa-check"></i><b>3.3.1</b> The Heuristic model</a></li>
<li class="chapter" data-level="3.3.2" data-path="types-of-attribution.html"><a href="types-of-attribution.html#the-algorithmic-model"><i class="fa fa-check"></i><b>3.3.2</b> The Algorithmic model</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="types-of-attribution.html"><a href="types-of-attribution.html#classification-of-methods"><i class="fa fa-check"></i><b>3.4</b> Classification of Methods</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>4</b> Methods</a><ul>
<li class="chapter" data-level="4.1" data-path="methods.html"><a href="methods.html#simplisitic-methods"><i class="fa fa-check"></i><b>4.1</b> Simplisitic Methods</a><ul>
<li class="chapter" data-level="4.1.1" data-path="methods.html"><a href="methods.html#last-touch"><i class="fa fa-check"></i><b>4.1.1</b> Last Touch</a></li>
<li class="chapter" data-level="4.1.2" data-path="methods.html"><a href="methods.html#first-touch"><i class="fa fa-check"></i><b>4.1.2</b> First Touch</a></li>
<li class="chapter" data-level="4.1.3" data-path="methods.html"><a href="methods.html#others"><i class="fa fa-check"></i><b>4.1.3</b> Others</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="methods.html"><a href="methods.html#fractional-heuristic-methods"><i class="fa fa-check"></i><b>4.2</b> Fractional Heuristic Methods</a><ul>
<li class="chapter" data-level="4.2.1" data-path="methods.html"><a href="methods.html#linear"><i class="fa fa-check"></i><b>4.2.1</b> Linear</a></li>
<li class="chapter" data-level="4.2.2" data-path="methods.html"><a href="methods.html#time-decay"><i class="fa fa-check"></i><b>4.2.2</b> Time Decay</a></li>
<li class="chapter" data-level="4.2.3" data-path="methods.html"><a href="methods.html#position-based"><i class="fa fa-check"></i><b>4.2.3</b> Position Based</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="methods.html"><a href="methods.html#fractional-algorithmic-methods"><i class="fa fa-check"></i><b>4.3</b> Fractional Algorithmic Methods</a><ul>
<li class="chapter" data-level="4.3.1" data-path="methods.html"><a href="methods.html#logistic-regression"><i class="fa fa-check"></i><b>4.3.1</b> Logistic Regression</a></li>
<li class="chapter" data-level="4.3.2" data-path="methods.html"><a href="methods.html#shapley-value"><i class="fa fa-check"></i><b>4.3.2</b> Shapley Value</a></li>
<li class="chapter" data-level="4.3.3" data-path="methods.html"><a href="methods.html#markov-methods"><i class="fa fa-check"></i><b>4.3.3</b> Markov Methods</a></li>
<li class="chapter" data-level="4.3.4" data-path="methods.html"><a href="methods.html#survivial-analysis"><i class="fa fa-check"></i><b>4.3.4</b> Survivial Analysis</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="methods.html"><a href="methods.html#comparison-of-methods"><i class="fa fa-check"></i><b>4.4</b> Comparison of Methods</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="google-analytics-data.html"><a href="google-analytics-data.html"><i class="fa fa-check"></i><b>5</b> Google Analytics Data</a><ul>
<li class="chapter" data-level="5.1" data-path="google-analytics-data.html"><a href="google-analytics-data.html#survey-of-basic-methods-in-google-analytics"><i class="fa fa-check"></i><b>5.1</b> Survey of Basic Methods in Google Analytics</a></li>
<li class="chapter" data-level="5.2" data-path="google-analytics-data.html"><a href="google-analytics-data.html#about-data-driven-attribution"><i class="fa fa-check"></i><b>5.2</b> About Data Driven Attribution</a><ul>
<li class="chapter" data-level="5.2.1" data-path="google-analytics-data.html"><a href="google-analytics-data.html#how-does-it-work"><i class="fa fa-check"></i><b>5.2.1</b> How does it work?</a></li>
<li class="chapter" data-level="5.2.2" data-path="google-analytics-data.html"><a href="google-analytics-data.html#limitations"><i class="fa fa-check"></i><b>5.2.2</b> Limitations</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="google-analytics-data.html"><a href="google-analytics-data.html#bigquery"><i class="fa fa-check"></i><b>5.3</b> BigQuery</a></li>
</ul></li>
<li class="part"><span><b>II Implementation Guides</b></span></li>
<li class="chapter" data-level="6" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i><b>6</b> Setup</a><ul>
<li class="chapter" data-level="6.1" data-path="setup.html"><a href="setup.html#r"><i class="fa fa-check"></i><b>6.1</b> R</a><ul>
<li class="chapter" data-level="6.1.1" data-path="setup.html"><a href="setup.html#about-r"><i class="fa fa-check"></i><b>6.1.1</b> About R</a></li>
<li class="chapter" data-level="6.1.2" data-path="setup.html"><a href="setup.html#install-r"><i class="fa fa-check"></i><b>6.1.2</b> Install R</a></li>
<li class="chapter" data-level="6.1.3" data-path="setup.html"><a href="setup.html#install-rstudio"><i class="fa fa-check"></i><b>6.1.3</b> Install RStudio</a></li>
<li class="chapter" data-level="6.1.4" data-path="setup.html"><a href="setup.html#install-required-r-packages"><i class="fa fa-check"></i><b>6.1.4</b> Install Required R Packages</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="setup.html"><a href="setup.html#bigquery-1"><i class="fa fa-check"></i><b>6.2</b> BigQuery</a><ul>
<li class="chapter" data-level="6.2.1" data-path="setup.html"><a href="setup.html#setup-1"><i class="fa fa-check"></i><b>6.2.1</b> Setup</a></li>
<li class="chapter" data-level="6.2.2" data-path="setup.html"><a href="setup.html#export-schema"><i class="fa fa-check"></i><b>6.2.2</b> Export Schema</a></li>
<li class="chapter" data-level="6.2.3" data-path="setup.html"><a href="setup.html#running-queries"><i class="fa fa-check"></i><b>6.2.3</b> Running Queries</a></li>
<li class="chapter" data-level="6.2.4" data-path="setup.html"><a href="setup.html#using-r-with-bigquery"><i class="fa fa-check"></i><b>6.2.4</b> Using R with BigQuery</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="extracting-data-from-bigquery.html"><a href="extracting-data-from-bigquery.html"><i class="fa fa-check"></i><b>7</b> Extracting Data from BigQuery</a><ul>
<li class="chapter" data-level="7.1" data-path="extracting-data-from-bigquery.html"><a href="extracting-data-from-bigquery.html#about-the-data"><i class="fa fa-check"></i><b>7.1</b> About the data</a></li>
<li class="chapter" data-level="7.2" data-path="extracting-data-from-bigquery.html"><a href="extracting-data-from-bigquery.html#get-full-event-log"><i class="fa fa-check"></i><b>7.2</b> Get full event log</a></li>
<li class="chapter" data-level="7.3" data-path="extracting-data-from-bigquery.html"><a href="extracting-data-from-bigquery.html#identify-those-who-converted"><i class="fa fa-check"></i><b>7.3</b> Identify those who converted</a></li>
<li class="chapter" data-level="7.4" data-path="extracting-data-from-bigquery.html"><a href="extracting-data-from-bigquery.html#converting-touchpoints-in-last-7-days"><i class="fa fa-check"></i><b>7.4</b> Converting touchpoints in last 7 days</a></li>
<li class="chapter" data-level="7.5" data-path="extracting-data-from-bigquery.html"><a href="extracting-data-from-bigquery.html#non-converting-touchpoints-in-last-7-days"><i class="fa fa-check"></i><b>7.5</b> Non-converting touchpoints in last 7 days</a></li>
<li class="chapter" data-level="7.6" data-path="extracting-data-from-bigquery.html"><a href="extracting-data-from-bigquery.html#complete-query"><i class="fa fa-check"></i><b>7.6</b> Complete Query</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="heuristic-models.html"><a href="heuristic-models.html"><i class="fa fa-check"></i><b>8</b> Heuristic Models</a><ul>
<li class="chapter" data-level="8.1" data-path="heuristic-models.html"><a href="heuristic-models.html#transform-data"><i class="fa fa-check"></i><b>8.1</b> Transform Data</a></li>
<li class="chapter" data-level="8.2" data-path="heuristic-models.html"><a href="heuristic-models.html#heuristic-models-1"><i class="fa fa-check"></i><b>8.2</b> Heuristic Models</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="algorithmic-methods.html"><a href="algorithmic-methods.html"><i class="fa fa-check"></i><b>9</b> Algorithmic Methods</a><ul>
<li class="chapter" data-level="9.1" data-path="algorithmic-methods.html"><a href="algorithmic-methods.html#markov-chains"><i class="fa fa-check"></i><b>9.1</b> Markov Chains</a></li>
<li class="chapter" data-level="9.2" data-path="algorithmic-methods.html"><a href="algorithmic-methods.html#survival-analysis"><i class="fa fa-check"></i><b>9.2</b> Survival Analysis</a></li>
</ul></li>
<li class="part"><span><b>III Offline Attribution</b></span></li>
<li class="chapter" data-level="10" data-path="about-offline-attribution.html"><a href="about-offline-attribution.html"><i class="fa fa-check"></i><b>10</b> About Offline Attribution</a><ul>
<li class="chapter" data-level="10.1" data-path="about-offline-attribution.html"><a href="about-offline-attribution.html#scenario"><i class="fa fa-check"></i><b>10.1</b> Scenario</a></li>
<li class="chapter" data-level="10.2" data-path="about-offline-attribution.html"><a href="about-offline-attribution.html#causal-inference-modelling"><i class="fa fa-check"></i><b>10.2</b> Causal Inference Modelling</a></li>
<li class="chapter" data-level="10.3" data-path="about-offline-attribution.html"><a href="about-offline-attribution.html#comparing-to-other-methods"><i class="fa fa-check"></i><b>10.3</b> Comparing to other methods</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Internetrix Advanced Guide to Attribution Modelling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="algorithmic-methods" class="section level1">
<h1><span class="header-section-number">9</span> Algorithmic Methods</h1>
<p>Now we move into algorithmic methods for modelling marketing attribution.</p>
<p>These methods use more advanced statistical algorithms to create a data driven
model for assigning conversion credit to channels in a multi-touch point
conversion pathway.</p>
<div id="markov-chains" class="section level2">
<h2><span class="header-section-number">9.1</span> Markov Chains</h2>
<p>The first method we will review are markov chains. We introduced these in
<a href="methods.html#markov-methods">section 4.3.3</a>.</p>
<p>First we load the required packages. In this case we again use <code>ChannelAttribution</code>
as well as the <code>tidyverse</code> and <code>lubridate</code> packages for data manipulation and
date handling. We also read in our raw results from BigQuery that contains the event log and
timestamps of visits, complete with channel and outcome.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(ChannelAttribution)

paths_raw &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;bigquery/bq-results.csv&#39;</span>)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">fullVisitorId</th>
<th align="left">visitStartTime</th>
<th align="left">channelGrouping</th>
<th align="left">outcome</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">07184911138250312</td>
<td align="left">2017-01-18 06:57:50 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="even">
<td align="left">07184911138250312</td>
<td align="left">2017-01-18 07:40:31 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="odd">
<td align="left">07184911138250312</td>
<td align="left">2017-01-18 08:18:50 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="even">
<td align="left">3112985461863519829</td>
<td align="left">2017-01-25 20:42:23 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="odd">
<td align="left">4720404071621394560</td>
<td align="left">2017-01-18 07:02:40 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="even">
<td align="left">6060076679741207514</td>
<td align="left">2017-01-18 06:59:27 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="odd">
<td align="left">0003297619580760716</td>
<td align="left">2017-01-08 05:50:50 UTC</td>
<td align="left">Direct</td>
<td align="left">non_conversion</td>
</tr>
<tr class="even">
<td align="left">00035794135966385</td>
<td align="left">2017-01-20 12:46:25 UTC</td>
<td align="left">Direct</td>
<td align="left">non_conversion</td>
</tr>
<tr class="odd">
<td align="left">0004867638405459898</td>
<td align="left">2017-01-15 14:22:26 UTC</td>
<td align="left">Direct</td>
<td align="left">non_conversion</td>
</tr>
<tr class="even">
<td align="left">0005604256236421547</td>
<td align="left">2017-01-24 21:04:26 UTC</td>
<td align="left">Direct</td>
<td align="left">non_conversion</td>
</tr>
</tbody>
</table>
<p>Next we need to transform the data. We use the same procedure as in <a href="heuristic-models.html#transform-data">Section 7.1</a>.
We now have one row per conversion path, with total conversions/non-conversions.</p>
<table>
<thead>
<tr class="header">
<th align="left">path</th>
<th align="right">conversion</th>
<th align="right">non_conversion</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Referral</td>
<td align="right">178</td>
<td align="right">4015</td>
</tr>
<tr class="even">
<td align="left">Organic Search</td>
<td align="right">137</td>
<td align="right">21659</td>
</tr>
<tr class="odd">
<td align="left">Direct</td>
<td align="right">71</td>
<td align="right">9308</td>
</tr>
<tr class="even">
<td align="left">Referral &gt; Referral</td>
<td align="right">55</td>
<td align="right">553</td>
</tr>
<tr class="odd">
<td align="left">Organic Search &gt; Organic Search</td>
<td align="right">39</td>
<td align="right">1507</td>
</tr>
<tr class="even">
<td align="left">Direct &gt; Direct</td>
<td align="right">26</td>
<td align="right">803</td>
</tr>
<tr class="odd">
<td align="left">Referral &gt; Referral &gt; Referral</td>
<td align="right">26</td>
<td align="right">132</td>
</tr>
<tr class="even">
<td align="left">Paid Search</td>
<td align="right">21</td>
<td align="right">1348</td>
</tr>
<tr class="odd">
<td align="left">Display</td>
<td align="right">12</td>
<td align="right">256</td>
</tr>
<tr class="even">
<td align="left">Direct &gt; Referral</td>
<td align="right">11</td>
<td align="right">60</td>
</tr>
</tbody>
</table>
<p>We now call the <code>markov_model()</code> function from the <code>ChannelAttribution</code> package. It accepts
arguments for the data frame, the variable that contains the conversion path,
the variable that encodes both number of conversions and non conversions and the
order of the markov model.</p>
<p>Below we can see it’s output is a list of distinct channels with the total
attributed conversions per channel. The channel that receives the most
credit is ‘Referral’, followed by ‘Organic Search’.</p>
<p>As a marketer we could multiply these by the average conversion value to get
a total attributed value for each channel. By comparing this to the cost of
marketing in each channel we get a robust calculation for ROI.</p>
<p>In fact, if the actual sales revenue per customer is recorded we can go
one step further and have this model calculate the attributed value without
having to estimate using the average value. This is handled with the argument
<code>var_value</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">fit_m &lt;-<span class="st"> </span><span class="kw">markov_model</span>(<span class="dt">Data =</span> paths, 
                      <span class="dt">var_path =</span> <span class="st">&#39;path&#39;</span>, 
                      <span class="dt">var_conv =</span> <span class="st">&#39;conversion&#39;</span>, 
                      <span class="dt">var_null =</span> <span class="st">&#39;non_conversion&#39;</span>, 
                      <span class="dt">order =</span> <span class="dv">1</span>)

fit_m</code></pre>
<pre><code>##     channel_name total_conversions
## 1       Referral       289.1465114
## 2 Organic Search       209.6476986
## 3         Direct       107.5363407
## 4    Paid Search        27.3277169
## 5        Display        18.8606878
## 6         Social         7.5544153
## 7        (Other)         0.1014015
## 8     Affiliates         1.8252278</code></pre>
<p>We can also iterate on this by calculating a 1, 2, and 3 order markov model.</p>
<p>Below we display a chart of the results. As we can see, there is not much
difference in the results.</p>
<pre class="sourceCode r"><code class="sourceCode r">fit_mult &lt;-<span class="st"> </span><span class="kw">map_dfr</span>(<span class="dt">.x =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), 
                    <span class="dt">.f =</span> <span class="op">~</span><span class="kw">markov_model</span>(<span class="dt">Data =</span> paths, 
                                       <span class="dt">var_path =</span> <span class="st">&#39;path&#39;</span>, 
                                       <span class="dt">var_conv =</span> <span class="st">&#39;conversion&#39;</span>, 
                                       <span class="dt">var_null =</span> <span class="st">&#39;non_conversion&#39;</span>, 
                                       <span class="dt">order =</span> .x), 
                    <span class="dt">.id =</span> <span class="st">&quot;order&quot;</span>)</code></pre>
<p><img src="irx-attribution-2019_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
</div>
<div id="survival-analysis" class="section level2">
<h2><span class="header-section-number">9.2</span> Survival Analysis</h2>
<p>The next model we demonstrate is survival analysis. Here we define ‘survival’
as non-conversion and the event of interest is when a customer converts.</p>
<p>As usual we start by loading the data and the required packages.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(survival)
<span class="kw">library</span>(survminer)

paths_raw &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;bigquery/bq-results.csv&#39;</span>)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">fullVisitorId</th>
<th align="left">visitStartTime</th>
<th align="left">channelGrouping</th>
<th align="left">outcome</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">07184911138250312</td>
<td align="left">2017-01-18 06:57:50 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="even">
<td align="left">07184911138250312</td>
<td align="left">2017-01-18 07:40:31 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="odd">
<td align="left">07184911138250312</td>
<td align="left">2017-01-18 08:18:50 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="even">
<td align="left">3112985461863519829</td>
<td align="left">2017-01-25 20:42:23 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="odd">
<td align="left">4720404071621394560</td>
<td align="left">2017-01-18 07:02:40 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="even">
<td align="left">6060076679741207514</td>
<td align="left">2017-01-18 06:59:27 UTC</td>
<td align="left">(Other)</td>
<td align="left">non_conversion</td>
</tr>
<tr class="odd">
<td align="left">0003297619580760716</td>
<td align="left">2017-01-08 05:50:50 UTC</td>
<td align="left">Direct</td>
<td align="left">non_conversion</td>
</tr>
<tr class="even">
<td align="left">00035794135966385</td>
<td align="left">2017-01-20 12:46:25 UTC</td>
<td align="left">Direct</td>
<td align="left">non_conversion</td>
</tr>
<tr class="odd">
<td align="left">0004867638405459898</td>
<td align="left">2017-01-15 14:22:26 UTC</td>
<td align="left">Direct</td>
<td align="left">non_conversion</td>
</tr>
<tr class="even">
<td align="left">0005604256236421547</td>
<td align="left">2017-01-24 21:04:26 UTC</td>
<td align="left">Direct</td>
<td align="left">non_conversion</td>
</tr>
</tbody>
</table>
<p>The data transformation steps here are a little different.</p>
<p>We want to condense our data into one row per customer. For our analysis,
three key pieces of information are required:</p>
<ol style="list-style-type: decimal">
<li>The interval of time:</li>
</ol>
<ol style="list-style-type: lower-alpha">
<li>For converting customers, between the first visit and the purchase time.</li>
<li>For non-converting customers, between the first visit and the last recorded
visit.</li>
</ol>
<ol start="2" style="list-style-type: decimal">
<li>The outcome: 1 for converted, 0 for non-converted.</li>
<li>The channel used to convert.</li>
</ol>
<p>Firstly, this analysis is slightly different. We aren’t strictly attributing
credit between channels, but rather analysing at various points in time, what
is the probability of a customer converting through any given channel.</p>
<p>Secondly, we have made some assumptions around excluding (or censoring) customers
who don’t convert at the point of the most recent visit. In effect we are declaring
these customer lost to follow up. An alternative method
would be to calculate the time interval for non-converters right up until the
end of the analysis period. Both are ok, but given we constrained our look back
period to just 7 days we will go with our chosen method.</p>
<pre class="sourceCode r"><code class="sourceCode r">surv_data &lt;-<span class="st"> </span>paths_raw <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">visitStartTime =</span> <span class="kw">ymd_hms</span>(visitStartTime)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(fullVisitorId) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mindate =</span> <span class="kw">min</span>(visitStartTime),
         <span class="dt">maxdate =</span> <span class="kw">max</span>(visitStartTime)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(visitStartTime <span class="op">==</span><span class="st"> </span>maxdate) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">time =</span> (maxdate <span class="op">-</span><span class="st"> </span>mindate)<span class="op">/</span><span class="dv">3600</span>,
         <span class="dt">status =</span> <span class="kw">ifelse</span>(outcome <span class="op">==</span><span class="st"> &quot;conversion&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(fullVisitorId, time, status, channelGrouping)</code></pre>
<pre><code>## # A tibble: 10 x 4
## # Groups:   fullVisitorId [10]
##    fullVisitorId       time            status channelGrouping
##    &lt;chr&gt;               &lt;drtn&gt;           &lt;dbl&gt; &lt;chr&gt;          
##  1 2019849659101397972 26.6350000 secs      0 Organic Search 
##  2 0602100966737642308  0.0000000 secs      0 Organic Search 
##  3 6693833242689696465  0.8844444 secs      0 Organic Search 
##  4 7956907751868983697  0.1047222 secs      0 Paid Search    
##  5 9483710368265788494  0.0000000 secs      0 Organic Search 
##  6 2139227959373761194  0.0000000 secs      0 Social         
##  7 2973441778247906125  0.0000000 secs      0 Organic Search 
##  8 6325419508306646730  0.0000000 secs      0 Direct         
##  9 9873658775382341673  0.0000000 secs      0 Organic Search 
## 10 7744114977873417883  0.0000000 secs      0 Organic Search</code></pre>
<p>Next we create a special object called a survival object using the <code>Surv</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r">surv_object &lt;-<span class="st"> </span><span class="kw">Surv</span>(<span class="dt">time =</span> surv_data<span class="op">$</span>time, <span class="dt">event =</span> surv_data<span class="op">$</span>status)</code></pre>
<p>We can now compute our estimate for a survival curve using the <code>survfit</code> function.</p>
<p>We include a grouping variable of the converting channel. This will calculate
one survival curve per group so we have a basis for comparison.</p>
<pre class="sourceCode r"><code class="sourceCode r">fit_surv &lt;-<span class="st"> </span><span class="kw">survfit</span>(surv_object <span class="op">~</span><span class="st"> </span>channelGrouping, <span class="dt">data =</span> surv_data)</code></pre>
<pre><code>## Call: survfit(formula = surv_object ~ channelGrouping, data = surv_data)
## 
##                                    n events median 0.95LCL 0.95UCL
## channelGrouping=(Other)            2      0     NA      NA      NA
## channelGrouping=Affiliates       963      0     NA      NA      NA
## channelGrouping=Direct         10555    106     NA     181      NA
## channelGrouping=Display          408     20     NA      NA      NA
## channelGrouping=Organic Search 24208    202     NA      NA      NA
## channelGrouping=Paid Search     1769     26     NA      NA      NA
## channelGrouping=Referral        5372    302     NA     174      NA
## channelGrouping=Social          9764      6     NA      NA      NA</code></pre>
<p>The results are best viewed graphically.</p>
<p>It is important to note that the terminology ‘survival’ in this context means
‘non-conversion’. It shows, up to a given time along the x-axis, what is the probability
of a customer <em>not</em> converting through a particular channel.</p>
<p><img src="irx-attribution-2019_files/figure-html/unnamed-chunk-65-1.png" width="960" /></p>
<p>What we want is the complement of this, that is, the cumulative event plot.</p>
<p>We can see that Referral channel achieves high levels of conversion very
quickly, representing a valuable channel. This is followed by Display, however
as time goes on, after 150 hours (~6 days) from first visit, channels such as
‘Direct’ and ‘Organic Search’ have a strong conversion probability. This indicates
that advertising and referral traffic are essential to raising awareness early on, and
after this, customer recall of the brand is high with customers returning
days later via direct and organic channels.</p>
<p><img src="irx-attribution-2019_files/figure-html/unnamed-chunk-66-1.png" width="960" /></p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="heuristic-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="about-offline-attribution.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["irx-attribution-2019.pdf", "irx-attribution-2019.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
